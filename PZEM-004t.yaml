#url: serial://ttyUSB1
url: serial://com5
update_rate: 3
pub_topic: pzem-004t
options:
  unit: 0x2c
  word_order: lowhigh
  scan_batching: 12
  range_batching: True
templates:
  - pzem_004t: &PZEM_004T
      pub_topic: pzem-004t
      registers:
        - pub_topic: "Voltage" # Voltage (0.1V)
          address: 0
          table: 'input'
          scale: 0.1
        - pub_topic: "Current" # Current (0.001A)
          address: 1
          table: 'input'
          type: uint32
          scale: 0.001
        - pub_topic: "Power" # Power (0.1W)
          address: 3
          table: 'input'
          type: uint32
          scale: 0.1
        #- pub_topic: "ApparentPower" # Power (0.1W)
        #  address: 3
        #  table: 'input'
        #  type: uint32
        #  scale: 0.1
        #- pub_topic: "ReactivePower" # Power (0.1W)
        #  address: 3
        #  table: 'input'
        #  type: uint32
        #  scale: 0.1
        - pub_topic: "Energy" # Energy (1Wh)
          address: 5
          table: 'input'
          type: uint32
        - pub_topic: "Frequency" # Power (0.1Hz)
          address: 7
          table: 'input'
          scale: 0.1
        - pub_topic: "Factor" # Power factor (0.001)
          address: 8
          table: 'input'
          scale: 0.001
        - pub_topic: "Alarm" # Alarm status
          address: 9
          table: 'input'
          value_map:
            yes: 0xFFFF
            no: 0
        - pub_topic: "AlarmThreshold" # Alarm threshold (1W)
          address: 1
          table: 'holding'
        - pub_topic: "Unit" # Device ID
          address: 2
          table: 'holding'
  
devices:
  - << : *PZEM_004T
    unit: 0x2c
    pub_topic: pzem-004t-001
#  - << : *PZEM_004T
#   unit: 0x48
#    pub_topic: pzem-004t-002
